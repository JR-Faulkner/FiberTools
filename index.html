<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Fiber Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Base layout */
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      transition: background-color 0.5s ease, color 0.5s ease;
      margin: 0;
    }

    /* Title Block */
    .app-title { text-align: center; margin-bottom: 20px; }
    .app-title h1 {
      font-size: 2.2em;
      color: #ff0000;
      text-shadow: 0 0 10px #ff0000, 0 0 20px #ff6600;
      margin: 0 0 5px 0;
    }
    .app-title .author {
      font-style: italic;
      font-size: 1.05em;
      text-align: right;
      margin-right: 20px;
      color: #00bfff;
      animation: lightning 2s infinite;
    }
    @keyframes lightning {
      0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
        text-shadow: 0 0 5px #00bfff, 0 0 15px #00ffff, 0 0 25px #00bfff;
        color: #00ffff;
      }
      20%, 24%, 55% {
        text-shadow: none;
        color: #00bfff;
      }
    }

    /* Accordion headers */
    h2 {
      margin: 0;
      padding: 15px;
      font-size: 1.4em;
      cursor: pointer;
      background: linear-gradient(90deg, #ff0000, #00ff00, #00bfff);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      -webkit-text-fill-color: transparent;
      transition: transform 0.3s ease;
      user-select: none;
    }
    h2:hover { transform: scale(1.03); }

    /* Accordion sections */
    .section {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.35s ease;
      will-change: max-height;
    }
    .section-inner {
      padding: 12px 10px 18px 10px;
    }

    /* Inputs */
    label, select, input {
      font-size: 1.05em;
      margin: 8px;
      padding: 6px 8px;
      border-radius: 6px;
    }
    input[type="number"] {
      width: 160px;
      box-sizing: border-box;
    }

    /* Buttons */
    button {
      padding: 10px 18px;
      margin-top: 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }
    button:hover {
      transform: scale(1.04);
      box-shadow: 0 0 10px #00ff00;
    }

    /* Results */
    #result, #ribbonResult {
      margin-top: 16px;
      font-size: 1.1em;
      font-weight: bold;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.25s ease, transform 0.25s ease;
      white-space: pre-line;
    }
    #result.show, #ribbonResult.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* Dark mode */
    body.dark { background-color: #000; color: #ff0000; }
    body.dark input, body.dark select {
      background-color: #111; color: #ff0000; border: 1px solid #ff0000;
    }
    body.dark button {
      background-color: #111; color: #00ff00; border: 1px solid #00ff00;
    }
    body.dark button:hover { background-color: #00ff00; color: #000; }
    body.dark #result, body.dark #ribbonResult { color: #00bfff; }

    /* Light mode */
    body.light { background-color: #fff; color: #000; }
    body.light input, body.light select {
      background-color: #f0f0f0; color: #000; border: 1px solid #000;
    }
    body.light button {
      background-color: #eee; color: #000; border: 1px solid #000;
    }
    body.light button:hover { background-color: #000; color: #fff; }
    body.light #result, body.light #ribbonResult { color: #0077cc; }

    /* Toggle switch */
    .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider {
      position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
      background-color: #ccc; transition: .4s; border-radius: 34px;
    }
    .slider:before {
      position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px;
      background-color: white; transition: .4s; border-radius: 50%;
    }
    input:checked + .slider { background-color: #2196F3; }
    input:checked + .slider:before { transform: translateX(26px); }
  </style>
</head>
<body class="dark">

  <div class="app-title">
    <h1>F.I.B.E.R. – Field Integrated Build & Engineering Resource</h1>
    <p class="author">By: Jovan Faulkner</p>
  </div>

  <!-- Fiber Loss Calculator -->
  <h2 onclick="toggleSection('lossSection')">Fiber Loss Calculator ▼</h2>
  <div id="lossSection" class="section">
    <div class="section-inner">
      <label>Distance: <input id="distance" type="number" placeholder="Enter value"></label>
      <label>Unit:
        <select id="unit">
          <option value="km">km</option>
          <option value="ft">feet</option>
        </select>
      </label><br>

      <label>Wavelength:
        <select id="wavelength">
          <option value="850">850 nm</option>
          <option value="1310">1310 nm</option>
          <option value="1490">1490 nm</option>
          <option value="1550" selected>1550 nm</option>
          <option value="1625">1625 nm</option>
        </select>
      </label><br>

      <label>Connectors: <input id="connectors" type="number" placeholder="0"></label>
      <label>Loss per connector:
        <select id="connectorLoss">
          <option value="0.45">0.45 dB</option>
          <option value="0.55">0.55 dB</option>
          <option value="0.75">0.75 dB</option>
        </select>
      </label><br>

      <label>Splices: <input id="splices" type="number" placeholder="0"></label>
      <label>Loss per splice:
        <select id="spliceLoss">
          <option value="0.03">0.03 dB</option>
          <option value="0.05">0.05 dB</option>
          <option value="0.10">0.10 dB</option>
        </select>
      </label><br>

      <button onclick="calcLoss()">Calculate Total Loss</button>
      <p id="result"></p>
    </div>
  </div>

  <!-- Fiber Ribbon Finder -->
  <h2 onclick="toggleSection('ribbonSection')">Fiber Ribbon Finder ▼</h2>
  <div id="ribbonSection" class="section">
    <div class="section-inner">
      <label>Strand Number: <input id="strand" type="number" placeholder="Enter strand #"></label><br>
      <button onclick="findRibbon()">Find Ribbon</button>
      <p id="ribbonResult"></p>
    </div>
  </div>

  <!-- Theme Mode -->
  <h2 onclick="toggleSection('themeSection')">Theme Mode ▼</h2>
  <div id="themeSection" class="section">
    <div class="section-inner">
      <label class="switch">
        <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
        <span class="slider"></span>
      </label>
      <p>Toggle Light/Dark Mode</p>
    </div>
  </div>

  <script>
    /* ---------- Accordion: robust, clickable, auto-resizing ---------- */
    function setSectionHeight(section) {
      // Temporarily set max-height to 'none' to measure true scrollHeight
      section.style.maxHeight = 'none';
      const target = section.scrollHeight;
      section.style.maxHeight = target + 'px';
    }

    function toggleSection(id) {
      const section = document.getElementById(id);
      const isOpen = section.style.maxHeight && section.style.maxHeight !== '0px';
      if (isOpen) {
        section.style.maxHeight = '0px';
      } else {
        setSectionHeight(section);
      }
    }

    // Keep open sections responsive (avoids clipping and unclickable areas)
    window.addEventListener('resize', () => {
      ['lossSection', 'ribbonSection', 'themeSection'].forEach(id => {
        const s = document.getElementById(id);
        const isOpen = s.style.maxHeight && s.style.maxHeight !== '0px';
        if (isOpen) setSectionHeight(s);
      });
    });

    /* ---------- Theme Mode ---------- */
    function applySavedTheme() {
      const saved = localStorage.getItem('fiber-theme');
      if (saved === 'light') {
        document.body.classList.remove('dark');
        document.body.classList.add('light');
        document.getElementById('themeToggle').checked = true;
      } else {
        document.body.classList.remove('light');
        document.body.classList.add('dark');
        document.getElementById('themeToggle').checked = false;
      }
    }
    function toggleTheme() {
      const toggle = document.getElementById('themeToggle');
      if (toggle.checked) {
        document.body.classList.remove('dark');
        document.body.classList.add('light');
        localStorage.setItem('fiber-theme', 'light');
      } else {
        document.body.classList.remove('light');
        document.body.classList.add('dark');
        localStorage.setItem('fiber-theme', 'dark');
      }
      // Recompute heights so color changes don't affect layout clickability
      ['lossSection', 'ribbonSection', 'themeSection'].forEach(id => {
        const s = document.getElementById(id);
        const isOpen = s.style.maxHeight && s.style.maxHeight !== '0px';
        if (isOpen) setSectionHeight(s);
      });
    }

    /* ---------- Fiber Loss Calculator ---------- */
    function calcLoss() {
      const dist = parseFloat(document.getElementById('distance').value) || 0;
      const unit = document.getElementById('unit').value;
      const wl = document.getElementById('wavelength').value;
      const connectors = parseInt(document.getElementById('connectors').value) || 0;
      const connectorLoss = parseFloat(document.getElementById('connectorLoss').value);
      const splices = parseInt(document.getElementById('splices').value) || 0;
      const spliceLoss = parseFloat(document.getElementById('spliceLoss').value);

      // attenuation coefficients (dB/km)
      const coeffs = { '850': 2.5, '1310': 0.35, '1490': 0.25, '1550': 0.20, '1625': 0.30 };

      let distanceKm = dist;
      if (unit === 'ft') {
        distanceKm = dist / 3280.84; // feet -> km
      }

      const fiberLoss = (coeffs[wl] || 0.2) * distanceKm;
      const total = fiberLoss + (connectors * connectorLoss) + (splices * spliceLoss);

      const resultEl = document.getElementById('result');
      resultEl.textContent =
        `Distance: ${dist} ${unit}\n` +
        `Wavelength: ${wl} nm\n` +
        `Fiber attenuation: ${fiberLoss.toFixed(3)} dB\n` +
        `Connectors (${connectors} × ${connectorLoss} dB): ${(connectors * connectorLoss).toFixed(3)} dB\n` +
        `Splices (${splices} × ${spliceLoss} dB): ${(splices * spliceLoss).toFixed(3)} dB\n` +
        `Total loss: ${total.toFixed(3)} dB`;

      resultEl.classList.add('show');

      // Ensure section height accommodates new content (keeps controls clickable)
      setSectionHeight(document.getElementById('lossSection'));
    }

    /* ---------- Ribbon Finder (12-fiber standard) ---------- */
    function findRibbon() {
      const n = parseInt(document.getElementById('strand').value);
      const out = document.getElementById('ribbonResult');

      if (!n || n < 1) {
        out.textContent = 'Enter a valid strand number (≥ 1).';
        out.classList.add('show');
        setSectionHeight(document.getElementById('ribbonSection'));
        return;
      }

      const colors12 = [
        'Blue','Orange','Green','Brown','Slate','White',
        'Red','Black','Yellow','Violet','Rose','Aqua'
      ];

      const position = ((n - 1) % 12) + 1;         // 1–12
      const ribbon = Math.floor((n - 1) / 12) + 1; // 1-based ribbon index
      const color = colors12[position - 1];

      out.textContent =
        `Strand: ${n}\n` +
        `Ribbon: ${ribbon}\n` +
        `Position in ribbon: ${position}\n` +
        `Color: ${color}`;

      out.classList.add('show');

      // Recompute height for clickability after content update
      setSectionHeight(document.getElementById('ribbonSection'));
    }

    /* ---------- Init ---------- */
    document.addEventListener('DOMContentLoaded', () => {
      applySavedTheme();

      // Optional: open the first section by default for quick access
      setSectionHeight(document.getElementById('lossSection'));
    });
  </script>
</body>

</html>

