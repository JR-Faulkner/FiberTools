<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>L.E.N.S. – Loss Estimator & Network Solver</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:Arial,sans-serif;text-align:center;padding:20px;transition:background-color .5s ease,color .5s ease;margin:0}
    .app-title{ text-align:center;margin-bottom:20px }
    .app-title h1{ font-size:2.2em;color:#ff0000;text-shadow:0 0 10px #ff0000,0 0 20px #ff6600;margin:0 0 5px 0 }
    .app-title .author{ font-style:italic;font-size:1.05em;text-align:right;margin-right:20px;color:#00bfff;animation:lightning 2s infinite }
    @keyframes lightning{0%,19%,21%,23%,25%,54%,56%,100%{text-shadow:0 0 5px #00bfff,0 0 15px #00ffff,0 0 25px #00bfff;color:#00ffff}20%,24%,55%{text-shadow:none;color:#00bfff}}
    h2{margin:0;padding:15px;font-size:1.4em;cursor:pointer;background:linear-gradient(90deg,#ff0000,#00ff00,#00bfff);-webkit-background-clip:text;background-clip:text;color:transparent;-webkit-text-fill-color:transparent;transition:transform .3s ease;user-select:none}
    h2:hover{transform:scale(1.03)}
    .section{max-height:0;overflow:hidden;transition:max-height .35s ease;will-change:max-height}
    .section-inner{padding:12px 10px 18px 10px}
    label,select,input{font-size:1.05em;margin:8px;padding:6px 8px;border-radius:6px}
    input[type=number]{width:160px;box-sizing:border-box}
    button{padding:10px 18px;margin-top:12px;border-radius:6px;cursor:pointer;transition:all .3s ease;border:1px solid transparent}
    button:hover{transform:scale(1.04);box-shadow:0 0 10px #00ff00}
    #result,#ribbonResult,#spliceCustomResult{margin-top:16px;font-size:1.1em;font-weight:bold;opacity:0;transform:translateY(8px);transition:opacity .25s ease,transform .25s ease;white-space:pre-line}
    #result.show,#ribbonResult.show,#spliceCustomResult.show{opacity:1;transform:translateY(0)}
    body.dark{background-color:#000;color:#ff0000}
    body.dark input,body.dark select{background-color:#111;color:#ff0000;border:1px solid #ff0000}
    body.dark button{background-color:#111;color:#00ff00;border:1px solid #00ff00}
    body.dark button:hover{background-color:#00ff00;color:#000}
    body.dark #result,body.dark #ribbonResult,body.dark #spliceCustomResult{color:#00bfff}
    body.light{background-color:#fff;color:#000}
    body.light input,body.light select{background-color:#f0f0f0;color:#000;border:1px solid #000}
    body.light button{background-color:#eee;color:#000;border:1px solid #000}
    body.light button:hover{background-color:#000;color:#fff}
    body.light #result,body.light #ribbonResult,body.light #spliceCustomResult{color:#0077cc}
    .switch{position:relative;display:inline-block;width:48px;height:26px}
    .switch input{opacity:0;width:0;height:0}
    .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.3s;border-radius:26px}
    .slider:before{position:absolute;content:"";height:18px;width:18px;left:4px;bottom:4px;background-color:white;transition:.3s;border-radius:50%}
    input:checked+.slider{background-color:#2196F3}
    input:checked+.slider:before{transform:translateX(22px)}
    @media(max-width:520px){.switch{width:44px;height:24px}.slider:before{height:16px;width:16px;left:4px;bottom:4px}input:checked+.slider:before{transform:translateX(20px)}}
    .custom-splices{margin-top:8px;border-radius:6px;padding:10px;background:rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:8px;max-width:760px;margin-left:auto;margin-right:auto}
    .splice-row{display:flex;gap:8px;align-items:center;justify-content:center;flex-wrap:wrap}
    .splice-row input[type="text"]{width:200px}
    .splice-row input[type="number"]{width:110px}
    .splice-actions{display:flex;gap:8px;justify-content:center;align-items:center}
    .small-note{font-size:0.9em;color:inherit;opacity:0.9}
  </style>
</head>
<body class="dark">

  <div class="app-title">
    <h1>L.E.N.S. – Loss Estimator & Network Solver</h1>
    <p class="author">By: Jovan Faulkner</p>
  </div>

  <h2 onclick="toggleSection('lossSection')">Fiber Loss Calculator ▼</h2>
  <div id="lossSection" class="section">
    <div class="section-inner">
      <label>Distance: <input id="distance" type="number" placeholder="Enter value"></label>
      <label>Unit:
        <select id="unit"><option value="km">km</option><option value="ft">feet</option></select>
      </label><br>

      <label>Wavelength:
        <select id="wavelength"><option value="850">850 nm</option><option value="1310">1310 nm</option><option value="1490">1490 nm</option><option value="1550" selected>1550 nm</option><option value="1625">1625 nm</option></select>
      </label><br>

      <label>Connectors: <input id="connectors" type="number" placeholder="0"></label>
      <label>Loss per connector:
        <select id="connectorLoss"><option value="0.45">0.45 dB</option><option value="0.55">0.55 dB</option><option value="0.75">0.75 dB</option></select>
      </label><br>

      <label>Splices: <input id="splices" type="number" placeholder="0"></label>
      <label>Loss per splice:
        <select id="spliceLoss"><option value="0.03">0.03 dB</option><option value="0.05">0.05 dB</option><option value="0.10">0.10 dB</option></select>
      </label><br>

      <div class="custom-splices" id="customSplicesArea" aria-live="polite">
        <div class="splice-row">
          <strong>Custom Splices</strong>
          <span class="small-note">Add specific splice entries to override or add to the splice count total</span>
        </div>

        <div class="splice-row" style="font-weight:700">
          <div style="width:200px;text-align:left">Label</div>
          <div style="width:110px;text-align:left">Count</div>
          <div style="width:110px;text-align:left">Loss (dB)</div>
          <div style="width:140px;text-align:left">Action</div>
        </div>

        <div id="spliceList" style="display:flex;flex-direction:column;gap:6px"></div>

        <div class="splice-actions">
          <input id="newSpliceLabel" type="text" placeholder="Name (e.g., mechanical joint)" />
          <input id="newSpliceCount" type="number" min="0" step="1" value="1" />
          <input id="newSpliceLoss" type="number" min="0" step="0.01" value="0.05" />
          <button id="addSpliceBtn">Add Splice</button>
          <button id="clearCustomBtn">Clear Custom</button>
        </div>

        <div id="spliceCustomResult" class="small-note" style="text-align:center"></div>
      </div>

      <button onclick="calcLoss()">Calculate Total Loss</button>
      <p id="result"></p>
    </div>
  </div>

  <h2 onclick="toggleSection('ribbonSection')">Fiber Ribbon Finder ▼</h2>
  <div id="ribbonSection" class="section">
    <div class="section-inner">
      <label>Strand Number: <input id="strand" type="number" placeholder="Enter strand #"></label><br>
      <button onclick="findRibbon()">Find Ribbon</button>
      <p id="ribbonResult"></p>
    </div>
  </div>

  <h2 onclick="toggleSection('themeSection')">Theme Mode ▼</h2>
  <div id="themeSection" class="section">
    <div class="section-inner">
      <label class="switch">
        <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
        <span class="slider"></span>
      </label>
      <p>Toggle Light/Dark Mode</p>
    </div>
  </div>

  <script>
    function $(id){return document.getElementById(id)}
    function setSectionHeight(section){section.style.maxHeight='none';const t=section.scrollHeight;section.style.maxHeight=t+'px'}
    function toggleSection(id){const s=$(id);const open=s.style.maxHeight&&s.style.maxHeight!=='0px';if(open){s.style.maxHeight='0px'}else{setSectionHeight(s)}}
    window.addEventListener('resize',()=>{['lossSection','ribbonSection','themeSection'].forEach(id=>{const s=$(id);const open=s.style.maxHeight&&s.style.maxHeight!=='0px';if(open) setSectionHeight(s)})})

    function applySavedTheme(){const saved=localStorage.getItem('lens-theme');if(saved==='light'){document.body.classList.remove('dark');document.body.classList.add('light');$('themeToggle').checked=true}else{document.body.classList.remove('light');document.body.classList.add('dark');$('themeToggle').checked=false}}
    function toggleTheme(){const t=$('themeToggle');if(t.checked){document.body.classList.remove('dark');document.body.classList.add('light');localStorage.setItem('lens-theme','light')}else{document.body.classList.remove('light');document.body.classList.add('dark');localStorage.setItem('lens-theme','dark')}['lossSection','ribbonSection','themeSection'].forEach(id=>{const s=$(id);const open=s.style.maxHeight&&s.style.maxHeight!=='0px';if(open) setSectionHeight(s)})}

    const spliceStore = []
    let spliceId = 1
    function renderSpliceList(){
      const list = $('spliceList'); list.innerHTML = ''
      if(spliceStore.length===0){$('spliceCustomResult').textContent = 'No custom splices added'} else {$('spliceCustomResult').textContent = `${spliceStore.length} custom splice entr${spliceStore.length===1?'y':'ies'} — totals applied in calculation`}
      spliceStore.forEach(s=>{
        const row = document.createElement('div'); row.className='splice-row'; row.style.justifyContent='center'
        row.innerHTML =
          `<div style="width:200px;text-align:left">${escapeHtml(s.label)}</div>
           <div style="width:110px;text-align:left">${s.count}</div>
           <div style="width:110px;text-align:left">${Number(s.loss).toFixed(3)}</div>
           <div style="width:140px;text-align:left"><button data-id="${s.id}" class="editSplice">Edit</button> <button data-id="${s.id}" class="removeSplice">Remove</button></div>`
        list.appendChild(row)
      })
      list.querySelectorAll('.removeSplice').forEach(btn=>btn.addEventListener('click',e=>{const id=Number(e.currentTarget.getAttribute('data-id'));removeSplice(id)}))
      list.querySelectorAll('.editSplice').forEach(btn=>btn.addEventListener('click',e=>{const id=Number(e.currentTarget.getAttribute('data-id'));openEditSplice(id)}))
    }
    function escapeHtml(str){ return String(str).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])) }
    function addCustomSplice(){const label=$('newSpliceLabel').value.trim()||`Splice ${spliceId}`;const count=Math.max(0,Math.floor(Number($('newSpliceCount').value)||1));const loss=parseFloat($('newSpliceLoss').value)||0;spliceStore.push({id:spliceId++,label,count,loss});$('newSpliceLabel').value='';$('newSpliceCount').value=1;$('newSpliceLoss').value=0.05;renderSpliceList();setSectionHeight($('lossSection'))}
    function removeSplice(id){const idx=spliceStore.findIndex(s=>s.id===id);if(idx>-1)spliceStore.splice(idx,1);renderSpliceList();setSectionHeight($('lossSection'))}
    function openEditSplice(id){const s=spliceStore.find(x=>x.id===id);if(!s)return;const newLabel=prompt('Edit splice label',s.label);if(newLabel===null) return;const newCount=Number(prompt('Edit splice count',s.count));if(Number.isNaN(newCount)) return;const newLoss=Number(prompt('Edit loss per splice (dB)',s.loss));if(Number.isNaN(newLoss)) return;s.label=String(newLabel);s.count=Math.max(0,Math.floor(newCount));s.loss=Number(newLoss);renderSpliceList();setSectionHeight($('lossSection'))}
    function clearCustomSplices(){spliceStore.length=0;renderSpliceList();setSectionHeight($('lossSection'))}

    function calcLoss(){
      const dist=parseFloat($('distance').value)||0;const unit=$('unit').value;const wl=$('wavelength').value
      const connectors=parseInt($('connectors').value)||0;const connectorLoss=parseFloat($('connectorLoss').value)||0
      const splices=parseInt($('splices').value)||0;const spliceLoss=parseFloat($('spliceLoss').value)||0
      const coeffs={'850':2.5,'1310':0.35,'1490':0.25,'1550':0.20,'1625':0.30}
      let distanceKm=dist;if(unit==='ft'){distanceKm=dist/3280.84}
      const fiberLoss=(coeffs[wl]||0.2)*distanceKm
      const customTotal=spliceStore.reduce((acc,s)=>acc+(s.count*Number(s.loss)),0)
      const totalSpliceFromInput=splices*spliceLoss
      const total=fiberLoss+(connectors*connectorLoss)+totalSpliceFromInput+customTotal
      const resultEl=$('result');let lines=[]
      lines.push(`Distance: ${dist} ${unit}`)
      lines.push(`Wavelength: ${wl} nm`)
      lines.push(`Fiber attenuation: ${fiberLoss.toFixed(3)} dB`)
      lines.push(`Connectors (${connectors} × ${connectorLoss} dB): ${(connectors*connectorLoss).toFixed(3)} dB`)
      lines.push(`Splices (input) (${splices} × ${spliceLoss} dB): ${totalSpliceFromInput.toFixed(3)} dB`)
      if(spliceStore.length>0){
        lines.push(`Custom splices (${spliceStore.length} entries):`)
        spliceStore.forEach(s=>{lines.push(` • ${s.label}: ${s.count} × ${Number(s.loss).toFixed(3)} dB = ${(s.count*s.loss).toFixed(3)} dB`)})
        lines.push(`Custom splices total: ${customTotal.toFixed(3)} dB`)
      } else {
        lines.push(`Custom splices total: 0.000 dB`)
      }
      lines.push(`Total loss: ${total.toFixed(3)} dB`)
      resultEl.textContent=lines.join('\n');resultEl.classList.add('show');setSectionHeight($('lossSection'))
    }

    function findRibbon(){const n=parseInt($('strand').value);const out=$('ribbonResult');if(!n||n<1){out.textContent='Enter a valid strand number (≥ 1).';out.classList.add('show');setSectionHeight($('ribbonSection'));return}const colors12=['Blue','Orange','Green','Brown','Slate','White','Red','Black','Yellow','Violet','Rose','Aqua'];const position=((n-1)%12)+1;const ribbon=Math.floor((n-1)/12)+1;const color=colors12[position-1];out.textContent=`Strand: ${n}\nRibbon: ${ribbon}\nPosition in ribbon: ${position}\nColor: ${color}`;out.classList.add('show');setSectionHeight($('ribbonSection'))}

    document.addEventListener('DOMContentLoaded',()=>{
      applySavedTheme()
      setSectionHeight($('lossSection'))
      renderSpliceList()
      $('addSpliceBtn').addEventListener('click',addCustomSplice)
      $('clearCustomBtn').addEventListener('click',clearCustomSplices)
    })

    function applySavedTheme(){const saved=localStorage.getItem('lens-theme');if(saved==='light'){document.body.classList.remove('dark');document.body.classList.add('light');$('themeToggle').checked=true}else{document.body.classList.remove('light');document.body.classList.add('dark');$('themeToggle').checked=false}}
    function toggleTheme(){const t=$('themeToggle');if(t.checked){document.body.classList.remove('dark');document.body.classList.add('light');localStorage.setItem('lens-theme','light')}else{document.body.classList.remove('light');document.body.classList.add('dark');localStorage.setItem('lens-theme','dark')}['lossSection','ribbonSection','themeSection'].forEach(id=>{const s=$(id);const open=s.style.maxHeight&&s.style.maxHeight!=='0px';if(open) setSectionHeight(s)})}
  </script>
</body>
</html>