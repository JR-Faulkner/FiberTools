<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>L.E.N.S. (Loss Estimator and Network Solver)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      margin: 0;
      transition: background-color 0.5s ease, color 0.5s ease;
    }
    .app-title h1 {
      font-size: 2.2em;
      color: #ff0000;
      text-shadow: 0 0 10px #ff0000, 0 0 20px #ff6600;
      margin: 0 0 5px 0;
    }
    .app-title .author {
      font-style: italic;
      font-size: 1.05em;
      text-align: right;
      margin-right: 20px;
      color: #00bfff;
      animation: lightning 2s infinite;
    }
    @keyframes lightning {
      0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
        text-shadow: 0 0 5px #00bfff, 0 0 15px #00ffff, 0 0 25px #00bfff;
        color: #00ffff;
      }
      20%, 24%, 55% {
        text-shadow: none;
        color: #00bfff;
      }
    }
    h2 {
      margin: 0;
      padding: 15px;
      font-size: 1.4em;
      cursor: pointer;
      background: linear-gradient(90deg, #ff0000, #00ff00, #00bfff);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      -webkit-text-fill-color: transparent;
      transition: transform 0.3s ease;
      user-select: none;
    }
    h2:hover { transform: scale(1.03); }
    .section {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.35s ease;
      will-change: max-height;
      width: 100%;
    }
    .section-inner {
      padding: 12px 10px 18px 10px;
      text-align: left;
    }
    label, select, input {
      font-size: 1.05em;
      margin: 8px;
      padding: 6px 8px;
      border-radius: 6px;
    }
    input[type="number"] { width: 160px; }
    button {
      padding: 10px 18px;
      margin-top: 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }
    button:hover {
      transform: scale(1.04);
      box-shadow: 0 0 10px #00ff00;
    }
    #result, #ribbonResult {
      margin-top: 16px;
      font-size: 1.1em;
      font-weight: bold;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.25s ease, transform 0.25s ease;
      white-space: pre-line;
    }
    #result.show, #ribbonResult.show {
      opacity: 1;
      transform: translateY(0);
    }
    body.dark { background-color: #000; color: #ff0000; }
    body.light { background-color: #fff; color: #000; }
  </style>
</head>
<body class="dark">

  <div class="app-title">
    <h1>L.E.N.S. – Loss Estimator and Network Solver</h1>
    <p class="author">By: Jovan Faulkner</p>
  </div>

  <!-- Fiber Loss Calculator -->
  <h2 onclick="toggleSection('lossSection')">Fiber Loss Calculator ▼</h2>
  <div id="lossSection" class="section">
    <div class="section-inner">
      <label>Distance: <input id="distance" type="number"></label>
      <label>Unit:
        <select id="unit">
          <option value="km">km</option>
          <option value="ft">feet</option>
        </select>
      </label><br>

      <label>Wavelength:
        <select id="wavelength">
          <option value="850">850 nm</option>
          <option value="1310">1310 nm</option>
          <option value="1490">1490 nm</option>
          <option value="1550" selected>1550 nm</option>
          <option value="1625">1625 nm</option>
        </select>
      </label><br>

      <label>Connectors: <input id="connectors" type="number"></label>
      <label>Loss per connector:
        <select id="connectorLoss">
          <option value="0.45">0.45 dB</option>
          <option value="0.55">0.55 dB</option>
          <option value="0.75">0.75 dB</option>
        </select>
      </label><br>

      <!-- Splice Mode Toggle -->
      <label>Splice Mode:
        <select id="spliceMode" onchange="handleSpliceMode()">
          <option value="same" selected>Same loss per splice</option>
          <option value="custom">Custom loss per splice</option>
        </select>
      </label><br>

      <div id="sameLossInputs">
        <label>Splices: <input id="splices" type="number"></label>
        <label>Loss per splice:
          <select id="spliceLoss">
            <option value="0.03">0.03 dB</option>
            <option value="0.05">0.05 dB</option>
            <option value="0.10">0.10 dB</option>
          </select>
        </label>
      </div>

      <button onclick="calcLoss()">Calculate Total Loss</button>
      <p id="result"></p>
    </div>
  </div>

  <!-- Ribbon Finder -->
  <h2 onclick="toggleSection('ribbonSection')">Fiber Ribbon Finder ▼</h2>
  <div id="ribbonSection" class="section">
    <div class="section-inner">
      <label>Strand Number: <input id="strand" type="number"></label><br>
      <button onclick="findRibbon()">Find Ribbon</button>
      <p id="ribbonResult"></p>
    </div>
  </div>

  <!-- Theme Mode -->
  <h2 onclick="toggleSection('themeSection')">Theme Mode ▼</h2>
  <div id="themeSection" class="section">
    <div class="section-inner">
      <label class="switch">
        <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
        <span class="slider"></span>
      </label>
      <p>Toggle Light/Dark Mode</p>
    </div>
  </div>

  <script>
    let customSpliceLosses = [];

    function setSectionHeight(section) {
      section.style.maxHeight = 'none';
      const target = section.scrollHeight;
      section.style.maxHeight = target + 'px';
    }
    function toggleSection(id) {
      const section = document.getElementById(id);
      const isOpen = section.style.maxHeight && section.style.maxHeight !== '0px';
      if (isOpen) {
        section.style.maxHeight = '0px';
      } else {
        setSectionHeight(section);
      }
    }
    window.addEventListener('resize', () => {
      ['lossSection','ribbonSection','themeSection'].forEach(id => {
        const s = document.getElementById(id);
        if (s.style.maxHeight && s.style.maxHeight !== '0px') setSectionHeight(s);
      });
    });

    function handleSpliceMode() {
      const mode = document.getElementById("spliceMode").value;
      const sameInputs = document.getElementById("sameLossInputs");
      if (mode === "same") {
        sameInputs.style.display = "block";
      } else {
        sameInputs.style.display = "none";
        const spliceCount = parseInt(prompt("How many splices?"), 10);
        if (!isNaN(spliceCount) && spliceCount > 0) {
          customSpliceLosses = [];
          for (let i = 1; i <= spliceCount; i++) {
            let loss = parseFloat(prompt(`Enter loss for splice ${i} (dB):`));
            customSpliceLosses.push(isNaN(loss) ? 0 : loss);
          }
        }
      }
      calcLoss();
    }

    function calcLoss() {
      const dist = parseFloat(document.getElementById('distance').value) || 0;
      const unit = document.getElementById('unit').value;
      const wl = document.getElementById('wavelength').value;
      const connectors = parseInt(document.getElementById('connectors').value) || 0;
      const connectorLoss = parseFloat(document.getElementById('connectorLoss').value);
      const spliceMode = document.getElementById('spliceMode').value;

      // attenuation coefficients (dB/km)
      const coeffs = { '850': 2.5, '1310': 0.35, '1490': 0.25, '1550': 0.20, '1625': 0.30 };

      let distanceKm = dist;
      if (unit === 'ft') distanceKm = dist / 3280.84;

      const fiberLoss = (coeffs[wl] || 0.2) * distanceKm;
      const connectorLossTotal = connectors * connectorLoss;

      let spliceLossTotal = 0;
      if (spliceMode === "same") {
        const splices = parseInt(document.getElementById('splices').value) || 0;
        const spliceLoss = parseFloat(document.getElementById('spliceLoss').value);
        spliceLossTotal = splices * spliceLoss;
      } else {
        spliceLossTotal = customSpliceLosses.reduce((a, b) => a + b, 0);
      }

      const total = fiberLoss + connectorLossTotal + spliceLossTotal;

      const resultEl = document.getElementById('result');
      resultEl.textContent =
        `Distance: ${dist} ${unit}\n` +
        `Wavelength: ${wl} nm\n` +
        `Fiber attenuation: ${fiberLoss.toFixed(3)} dB\n` +
        `Connectors (${connectors} × ${connectorLoss} dB): ${connectorLossTotal.toFixed(3)} dB\n` +
        `Splices total: ${spliceLossTotal.toFixed(3)} dB\n` +
        `Total loss: ${total.toFixed(3)} dB`;

      resultEl.classList.add('show');
      setSectionHeight(document.getElementById('lossSection'));
    }

    function findRibbon() {
      const n = parseInt(document.getElementById('strand').value);
      const out = document.getElementById('ribbonResult');
      if (!n || n < 1) {
        out.textContent = 'Enter a valid strand number (≥ 1).';
        out.classList.add('show');
        setSectionHeight(document.getElementById('ribbonSection'));
        return;
      }
      const colors12 = [
        'Blue','Orange','Green','Brown','Slate','White',
        'Red','Black','Yellow','Violet','Rose','Aqua'
      ];
      const position = ((n - 1) % 12) + 1;
      const ribbon = Math.floor((n - 1) / 12) + 1;
      const color = colors12[position - 1];
      out.textContent =
        `Strand: ${n}\n` +
        `Ribbon: ${ribbon}\n` +
        `Position in ribbon: ${position}\n` +
        `Color: ${color}`;
      out.classList.add('show');
      setSectionHeight(document.getElementById('ribbonSection'));
    }

    function applySavedTheme() {
      const saved = localStorage.getItem('lens-theme');
      if (saved === 'light') {
        document.body.classList.remove('dark');
        document.body.classList.add('light');
        document.getElementById('themeToggle').checked = true;
      } else {
        document.body.classList.remove('light');
        document.body.classList.add('dark');
        document.getElementById('themeToggle').checked = false;
      }
    }
    function toggleTheme() {
      const toggle = document.getElementById('themeToggle');
      if (toggle.checked) {
        document.body.classList.remove('dark');
        document.body.classList.add('light');
        localStorage.setItem('lens-theme', 'light');
      } else {
        document.body.classList.remove('light');
        document.body.classList.add('dark');
        localStorage.setItem('lens-theme', 'dark');
      }
      ['lossSection','ribbonSection','themeSection'].forEach(id => {
        const s = document.getElementById(id);
        if (s.style.maxHeight && s.style.maxHeight !== '0px') setSectionHeight(s);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      applySavedTheme();
      setSectionHeight(document.getElementById('lossSection'));
    });
  </script>
</body>
</html>
